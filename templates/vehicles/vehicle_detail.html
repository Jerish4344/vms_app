{% extends 'base.html' %}
{% load static %}

{% block title %}{{ vehicle.license_plate }} - Vehicle Details{% endblock %}

{% block extra_css %}
<style>
  .vehicle-info-section {
    margin-bottom: 1rem;
  }
  
  .image-container {
    height: 150px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    margin-bottom: 1rem;
  }
  
  .vehicle-image {
    max-height: 150px;
    max-width: 100%;
    object-fit: contain;
    border-radius: 0.5rem;
  }
  
  .vehicle-image-placeholder {
    height: 150px;
    width: 100%;
    background-color: #f8f9fc;
    border-radius: 0.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 1rem;
  }
  
  .vehicle-image-placeholder i {
    font-size: 3rem;
    color: #d1d3e2;
  }
  
  .detail-label {
    font-weight: 700;
    font-size: 0.8rem;
    text-transform: uppercase;
    color: #858796;
    margin-bottom: 0.1rem;
  }
  
  .detail-value {
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }
  
  .vehicle-actions a {
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
  }
  
  .card-header-tabs {
    margin-bottom: -0.5rem;
  }
  
  .compact-tabs .nav-link {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }
  
  .spec-item {
    text-align: center;
    background-color: #f8f9fc;
    border-radius: 0.5rem;
    padding: 0.75rem 0.5rem;
    margin-bottom: 0.75rem;
  }
  
  .spec-icon {
    font-size: 1.25rem;
    margin-bottom: 0.25rem;
    color: var(--primary-color);
  }
  
  .spec-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    font-weight: 700;
    color: #858796;
    margin-bottom: 0.1rem;
  }
  
  .spec-value {
    font-size: 1rem;
    font-weight: 700;
  }
  
  .card-header {
    padding: 0.75rem 1.25rem;
  }
  
  .card-body {
    padding: 1rem;
  }
  
  .compact-card {
    margin-bottom: 1rem;
  }
  
  .document-card,
  .maintenance-card {
    height: 100%;
    margin-bottom: 0.75rem;
  }
  
  .status-badge {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
  }
  
  .detail-section {
    margin-bottom: 0.75rem;
  }
  
  .table-compact td, .table-compact th {
    padding: 0.5rem;
    font-size: 0.9rem;
  }
  
  .vehicle-type-indicator {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }
  
  .type-electric {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  
  .type-commercial {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
  }
  
  .type-regular {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
  <!-- Vehicle Header -->
  <div class="detail-header mb-3">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="h3 mb-0">
          {{ vehicle.make }} {{ vehicle.model }} ({{ vehicle.license_plate }})
        </h1>
        <div class="detail-meta">
          <span class="me-2"><i class="fas fa-calendar-alt me-1"></i> {{ vehicle.year }}</span>
          <span class="me-2"><i class="fas fa-tag me-1"></i> {{ vehicle.vehicle_type.name }}</span>
          <span class="me-2"><i class="fas fa-tachometer-alt me-1"></i> {{ vehicle.current_odometer }} km</span>
          <span class="badge bg-{{ vehicle.status|status_color }}">{{ vehicle.get_status_display }}</span>
          
          <!-- Vehicle Type Indicator -->
          {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
            <span class="vehicle-type-indicator type-electric ms-2">
              <i class="fas fa-bolt"></i> Electric
            </span>
          {% elif 'TRUCK' in vehicle.vehicle_type.name.upper or 'VAN' in vehicle.vehicle_type.name.upper or 'PICKUP' in vehicle.vehicle_type.name.upper or 'COMMERCIAL' in vehicle.vehicle_type.name.upper %}
            <span class="vehicle-type-indicator type-commercial ms-2">
              <i class="fas fa-truck"></i> Commercial
            </span>
          {% else %}
            <span class="vehicle-type-indicator type-regular ms-2">
              <i class="fas fa-car"></i> Regular
            </span>
          {% endif %}
        </div>
      </div>
      <div class="col-md-4 text-md-end">
        <div class="vehicle-actions">
          {% if request.user.user_type != 'driver' %}
            <a href="{% url 'vehicle_update' vehicle.id %}" class="btn btn-sm btn-primary">
              <i class="fas fa-edit me-1"></i> Edit
            </a>
          {% endif %}
          
          {% if request.user.user_type == 'driver' and vehicle.status == 'available' %}
            <a href="{% url 'start_trip' %}?vehicle={{ vehicle.id }}" class="btn btn-sm btn-success">
              <i class="fas fa-play me-1"></i> Start Trip
            </a>
          {% endif %}
          
          <a href="javascript:history.back()" class="btn btn-sm btn-secondary">
            <i class="fas fa-arrow-left me-1"></i> Back
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Quick Info Cards -->
  <div class="row mb-3">
    <!-- Basic Info & Image -->
    <div class="col-md-3">
      <div class="card compact-card h-100">
        <div class="card-header py-2">
          <h6 class="m-0 font-weight-bold text-primary">Image & Basic Info</h6>
        </div>
        <div class="card-body text-center">
          {% if vehicle.image %}
            <img src="{{ vehicle.image.url }}" alt="{{ vehicle.license_plate }}" class="vehicle-image mb-3">
          {% else %}
            <div class="vehicle-image-placeholder mb-3">
              <i class="fas fa-car"></i>
            </div>
          {% endif %}
          
          <div class="text-center">
            <div class="detail-label">License Plate</div>
            <div class="detail-value">{{ vehicle.license_plate }}</div>
            
            <div class="detail-label">Make & Model</div>
            <div class="detail-value">{{ vehicle.make }} {{ vehicle.model }}</div>
            
            <div class="detail-label">VIN</div>
            <div class="detail-value">{{ vehicle.vin }}</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Specifications Card -->
    <div class="col-md-3">
      <div class="card compact-card h-100">
        <div class="card-header py-2">
          <h6 class="m-0 font-weight-bold text-primary">Specifications</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-6">
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="spec-label">Odometer</div>
                <div class="spec-value">{{ vehicle.current_odometer }}</div>
              </div>
            </div>
            <div class="col-6">
              <div class="spec-item">
                {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                  <div class="spec-icon"><i class="fas fa-bolt"></i></div>
                  <div class="spec-label">Battery</div>
                  <div class="spec-value">
                    {% if vehicle.battery_capacity_kwh %}
                      {{ vehicle.battery_capacity_kwh }} kWh
                    {% else %}
                      Electric
                    {% endif %}
                  </div>
                {% else %}
                  <div class="spec-icon"><i class="fas fa-gas-pump"></i></div>
                  <div class="spec-label">Fuel Type</div>
                  <div class="spec-value">{{ vehicle.fuel_type|default:"N/A" }}</div>
                {% endif %}
              </div>
            </div>
            <div class="col-6">
              <div class="spec-item">
                {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                  <div class="spec-icon"><i class="fas fa-road"></i></div>
                  <div class="spec-label">Range</div>
                  <div class="spec-value">
                    {% if vehicle.range_per_charge %}
                      {{ vehicle.range_per_charge }} km
                    {% else %}
                      N/A
                    {% endif %}
                  </div>
                {% else %}
                  <div class="spec-icon"><i class="fas fa-fill-drip"></i></div>
                  <div class="spec-label">Capacity</div>
                  <div class="spec-value">
                    {% if vehicle.fuel_capacity %}
                      {{ vehicle.fuel_capacity }}L
                    {% else %}
                      N/A
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="col-6">
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-users"></i></div>
                <div class="spec-label">Seating</div>
                <div class="spec-value">{{ vehicle.seating_capacity }}</div>
              </div>
            </div>
            {% if 'TRUCK' in vehicle.vehicle_type.name.upper or 'VAN' in vehicle.vehicle_type.name.upper or 'PICKUP' in vehicle.vehicle_type.name.upper or 'COMMERCIAL' in vehicle.vehicle_type.name.upper %}
              {% if vehicle.load_capacity_kg %}
              <div class="col-6">
                <div class="spec-item">
                  <div class="spec-icon"><i class="fas fa-weight-hanging"></i></div>
                  <div class="spec-label">Load Cap.</div>
                  <div class="spec-value">{{ vehicle.load_capacity_kg }} kg</div>
                </div>
              </div>
              {% endif %}
            {% endif %}
            <div class="col-6">
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-palette"></i></div>
                <div class="spec-label">Color</div>
                <div class="spec-value">{{ vehicle.color }}</div>
              </div>
            </div>
            <div class="col-6">
              <div class="spec-item">
                {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                  <div class="spec-icon"><i class="fas fa-plug"></i></div>
                  <div class="spec-label">Charging</div>
                  <div class="spec-value">
                    {% if vehicle.charging_type %}
                      {{ vehicle.charging_type }}
                    {% else %}
                      N/A
                    {% endif %}
                  </div>
                {% else %}
                  <div class="spec-icon"><i class="fas fa-route"></i></div>
                  <div class="spec-label">Mileage</div>
                  <div class="spec-value">
                    {% if vehicle.average_mileage %}
                      {{ vehicle.average_mileage }} km/L
                    {% else %}
                      N/A
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Registration & Documents -->
    <div class="col-md-3">
      <div class="card compact-card h-100">
        <div class="card-header py-2">
          <h6 class="m-0 font-weight-bold text-primary">Documents</h6>
        </div>
        <div class="card-body">
          <div class="vehicle-info-section">
            {% if vehicle.owner_name %}
              <div class="detail-label">Owner</div>
              <div class="detail-value">{{ vehicle.owner_name }}</div>
            {% endif %}
            
            {% if vehicle.rc_valid_till %}
              <div class="detail-label">RC Valid Till</div>
              <div class="detail-value">{{ vehicle.rc_valid_till|date:"M d, Y" }}</div>
            {% endif %}
            
            {% if vehicle.insurance_expiry_date %}
              <div class="detail-label">Insurance Expiry</div>
              <div class="detail-value">{{ vehicle.insurance_expiry_date|date:"M d, Y" }}</div>
            {% endif %}
            
            {% if vehicle.fitness_expiry %}
              <div class="detail-label">Fitness Expiry</div>
              <div class="detail-value">{{ vehicle.fitness_expiry|date:"M d, Y" }}</div>
            {% endif %}
            
            {% if vehicle.permit_expiry %}
              <div class="detail-label">Permit Expiry</div>
              <div class="detail-value">{{ vehicle.permit_expiry|date:"M d, Y" }}</div>
            {% endif %}
            
            {% if vehicle.pollution_cert_expiry %}
              <div class="detail-label">Pollution Expiry</div>
              <div class="detail-value">{{ vehicle.pollution_cert_expiry|date:"M d, Y" }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Usage Information -->
    <div class="col-md-3">
      <div class="card compact-card h-100">
        <div class="card-header py-2">
          <h6 class="m-0 font-weight-bold text-primary">Usage Information</h6>
        </div>
        <div class="card-body">
          <div class="vehicle-info-section">
            {% if vehicle.purpose_of_vehicle %}
              <div class="detail-label">Purpose</div>
              <div class="detail-value">{{ vehicle.purpose_of_vehicle }}</div>
            {% endif %}
            
            {% if vehicle.company_owned %}
              <div class="detail-label">Company Owned</div>
              <div class="detail-value">{{ vehicle.get_company_owned_display }}</div>
            {% endif %}
            
            {% if vehicle.usage_type %}
              <div class="detail-label">Usage Type</div>
              <div class="detail-value">{{ vehicle.get_usage_type_display }}</div>
            {% endif %}
            
            {% if vehicle.gps_fitted %}
              <div class="detail-label">GPS Fitted</div>
              <div class="detail-value">
                {{ vehicle.get_gps_fitted_display }}
                {% if vehicle.gps_name %} ({{ vehicle.gps_name }}){% endif %}
              </div>
            {% endif %}
            
            {% if vehicle.driver_contact or vehicle.assigned_driver %}
              <div class="detail-label">Driver</div>
              <div class="detail-value">
                {% if vehicle.assigned_driver %}{{ vehicle.assigned_driver }}{% endif %}
                {% if vehicle.driver_contact %} ({{ vehicle.driver_contact }}){% endif %}
              </div>
            {% endif %}
            
            {% if vehicle.used_by %}
              <div class="detail-label">Used By</div>
              <div class="detail-value">{{ vehicle.used_by }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Fuel & Energy Information Card -->
  <div class="card mb-4">
    <div class="card-header py-2">
      <h6 class="m-0 font-weight-bold text-primary">
        {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
          <i class="fas fa-bolt"></i> Energy Information
        {% else %}
          <i class="fas fa-gas-pump"></i> Fuel Information
        {% endif %}
      </h6>
    </div>
    <div class="card-body">
      <div class="row">
        {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
          <!-- Electric Vehicle Information -->
          {% if vehicle.battery_capacity_kwh %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Battery Capacity</div>
            <div class="detail-value">{{ vehicle.battery_capacity_kwh }} kWh</div>
          </div>
          {% endif %}
          
          {% if vehicle.range_per_charge %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Range per Charge</div>
            <div class="detail-value">{{ vehicle.range_per_charge }} km</div>
          </div>
          {% endif %}
          
          {% if vehicle.charging_type %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Charging Type</div>
            <div class="detail-value">{{ vehicle.charging_type }}</div>
          </div>
          {% endif %}
          
          {% if vehicle.charging_time_hours %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Charging Time</div>
            <div class="detail-value">{{ vehicle.charging_time_hours }} hours</div>
          </div>
          {% endif %}
        {% else %}
          <!-- Fuel Vehicle Information -->
          {% if vehicle.fuel_type %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Fuel Type</div>
            <div class="detail-value">{{ vehicle.fuel_type }}</div>
          </div>
          {% endif %}
          
          {% if vehicle.fuel_capacity %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Fuel Capacity</div>
            <div class="detail-value">{{ vehicle.fuel_capacity }} L</div>
          </div>
          {% endif %}
          
          {% if vehicle.average_mileage %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Average Mileage</div>
            <div class="detail-value">{{ vehicle.average_mileage }} km/L</div>
          </div>
          {% endif %}
        {% endif %}
        
        <!-- Commercial Vehicle Load Capacity -->
        {% if 'TRUCK' in vehicle.vehicle_type.name.upper or 'VAN' in vehicle.vehicle_type.name.upper or 'PICKUP' in vehicle.vehicle_type.name.upper or 'COMMERCIAL' in vehicle.vehicle_type.name.upper %}
          {% if vehicle.load_capacity_kg %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Load Capacity</div>
            <div class="detail-value">{{ vehicle.load_capacity_kg }} kg</div>
          </div>
          {% endif %}
        {% endif %}
        
        <!-- Always show seating capacity -->
        <div class="col-md-3 mb-2">
          <div class="detail-label">Seating Capacity</div>
          <div class="detail-value">{{ vehicle.seating_capacity }} seats</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Enhanced Specifications Card for EV and Commercial -->
  {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper or 'TRUCK' in vehicle.vehicle_type.name.upper or 'VAN' in vehicle.vehicle_type.name.upper or 'PICKUP' in vehicle.vehicle_type.name.upper or 'COMMERCIAL' in vehicle.vehicle_type.name.upper %}
  <div class="card mb-4">
    <div class="card-header py-2">
      <h6 class="m-0 font-weight-bold text-primary">
        {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
          <i class="fas fa-bolt"></i> Electric Vehicle Specifications
        {% else %}
          <i class="fas fa-truck"></i> Commercial Vehicle Specifications
        {% endif %}
      </h6>
    </div>
    <div class="card-body">
      <div class="row">
        {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
          <!-- Electric Vehicle Info -->
          {% if vehicle.battery_capacity_kwh %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Battery Capacity</div>
            <div class="detail-value">{{ vehicle.battery_capacity_kwh }} kWh</div>
          </div>
          {% endif %}
          
          {% if vehicle.range_per_charge %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Range per Charge</div>
            <div class="detail-value">{{ vehicle.range_per_charge }} km</div>
          </div>
          {% endif %}
          
          {% if vehicle.charging_type %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Charging Type</div>
            <div class="detail-value">{{ vehicle.charging_type }}</div>
          </div>
          {% endif %}
          
          {% if vehicle.charging_time_hours %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Charging Time</div>
            <div class="detail-value">{{ vehicle.charging_time_hours }} hours</div>
          </div>
          {% endif %}
        {% endif %}
        
        {% if 'TRUCK' in vehicle.vehicle_type.name.upper or 'VAN' in vehicle.vehicle_type.name.upper or 'PICKUP' in vehicle.vehicle_type.name.upper or 'COMMERCIAL' in vehicle.vehicle_type.name.upper %}
          <!-- Commercial Vehicle Info -->
          {% if vehicle.load_capacity_kg %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Load Capacity</div>
            <div class="detail-value">{{ vehicle.load_capacity_kg }} kg</div>
          </div>
          {% endif %}
          
          {% if vehicle.fuel_type %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Fuel Type</div>
            <div class="detail-value">{{ vehicle.fuel_type }}</div>
          </div>
          {% endif %}
          
          {% if vehicle.fuel_capacity %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Fuel Capacity</div>
            <div class="detail-value">{{ vehicle.fuel_capacity }} L</div>
          </div>
          {% endif %}
          
          {% if vehicle.average_mileage %}
          <div class="col-md-3 mb-2">
            <div class="detail-label">Average Mileage</div>
            <div class="detail-value">{{ vehicle.average_mileage }} km/L</div>
          </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}
  
  <!-- Document Status Card -->
  <div class="card mb-4">
    <div class="card-header py-2">
      <h6 class="m-0 font-weight-bold text-primary">Document Status</h6>
    </div>
    <div class="card-body">
      <div class="row">
        {% if vehicle.rc_valid_till %}
          <div class="col-md-6 mb-2">
            <div class="detail-label">RC Valid Till</div>
            <div class="detail-value">
              {{ vehicle.rc_valid_till|date:"M d, Y" }}
              {% if vehicle.rc_valid_till < today %}
                <span class="badge bg-danger">Expired</span>
              {% elif vehicle.rc_valid_till|timeuntil:today <= '30 days' %}
                <span class="badge bg-warning">Expiring Soon</span>
              {% else %}
                <span class="badge bg-success">Valid</span>
              {% endif %}
            </div>
          </div>
        {% endif %}
        
        {% if vehicle.insurance_expiry_date %}
          <div class="col-md-6 mb-2">
            <div class="detail-label">Insurance Expiry</div>
            <div class="detail-value">
              {{ vehicle.insurance_expiry_date|date:"M d, Y" }}
              {% if vehicle.insurance_expiry_date < today %}
                <span class="badge bg-danger">Expired</span>
              {% elif vehicle.insurance_expiry_date|timeuntil:today <= '30 days' %}
                <span class="badge bg-warning">Expiring Soon</span>
              {% else %}
                <span class="badge bg-success">Valid</span>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
      
      <div class="row">
        {% if vehicle.fitness_expiry %}
          <div class="col-md-6 mb-2">
            <div class="detail-label">Fitness Expiry</div>
            <div class="detail-value">
              {{ vehicle.fitness_expiry|date:"M d, Y" }}
              {% if vehicle.fitness_expiry < today %}
                <span class="badge bg-danger">Expired</span>
              {% elif vehicle.fitness_expiry|timeuntil:today <= '30 days' %}
                <span class="badge bg-warning">Expiring Soon</span>
              {% else %}
                <span class="badge bg-success">Valid</span>
              {% endif %}
            </div>
          </div>
        {% endif %}
        
        {% if vehicle.pollution_cert_expiry %}
          <div class="col-md-6 mb-2">
            <div class="detail-label">Pollution Certificate Expiry</div>
            <div class="detail-value">
              {{ vehicle.pollution_cert_expiry|date:"M d, Y" }}
              {% if vehicle.pollution_cert_expiry < today %}
                <span class="badge bg-danger">Expired</span>
              {% elif vehicle.pollution_cert_expiry|timeuntil:today <= '30 days' %}
                <span class="badge bg-warning">Expiring Soon</span>
              {% else %}
                <span class="badge bg-success">Valid</span>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  
  <!-- Vehicle Data Tabs -->
  <div class="card mb-4">
    <div class="card-header p-0">
      <ul class="nav nav-tabs card-header-tabs compact-tabs" id="vehicleDetailTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab" aria-controls="documents" aria-selected="true">Documents</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="maintenance-tab" data-bs-toggle="tab" data-bs-target="#maintenance" type="button" role="tab" aria-controls="maintenance" aria-selected="false">Maintenance</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="fuel-tab" data-bs-toggle="tab" data-bs-target="#fuel" type="button" role="tab" aria-controls="fuel" aria-selected="false">
            {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
              Charging
            {% else %}
              Fuel
            {% endif %}
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="trips-tab" data-bs-toggle="tab" data-bs-target="#trips" type="button" role="tab" aria-controls="trips" aria-selected="false">Trips</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="accidents-tab" data-bs-toggle="tab" data-bs-target="#accidents" type="button" role="tab" aria-controls="accidents" aria-selected="false">Accidents</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab" aria-controls="notes" aria-selected="false">Notes</button>
        </li>
      </ul>
    </div>
    <div class="card-body">
      <div class="tab-content" id="vehicleDetailTabsContent">
        <!-- Documents Tab -->
        <div class="tab-pane fade show active" id="documents" role="tabpanel" aria-labelledby="documents-tab">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0">Vehicle Documents</h5>
            {% if request.user.user_type != 'driver' %}
              <a href="{% url 'document_create' %}?vehicle={{ vehicle.id }}" class="btn btn-sm btn-primary">
                <i class="fas fa-plus me-1"></i> Add Document
              </a>
            {% endif %}
          </div>
          
          {% if documents %}
            <div class="row">
              {% for document in documents %}
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="card document-card h-100">
                    <div class="card-body p-3">
                      <h6 class="card-title">{{ document.document_type.name }}</h6>
                      <p class="card-text small mb-2">
                        Document #: {{ document.document_number }}<br>
                        Issued: {{ document.issue_date|date:"M d, Y" }}<br>
                        Expires: 
                        <span class="{% if document.is_expired %}text-danger fw-bold{% elif document.expiry_date|timeuntil:today <= '30 days' %}text-warning fw-bold{% endif %}">
                          {{ document.expiry_date|date:"M d, Y" }}
                        </span>
                      </p>
                      <div class="d-flex mt-2">
                        {% if document.file %}
                          <a href="{{ document.file.url }}" target="_blank" class="btn btn-sm btn-info me-1">
                            <i class="fas fa-file-alt"></i>
                          </a>
                        {% endif %}
                        {% if request.user.user_type != 'driver' %}
                          <a href="{% url 'document_detail' document.id %}" class="btn btn-sm btn-primary">
                            <i class="fas fa-info-circle"></i> Details
                          </a>
                        {% endif %}
                      </div>
                    </div>
                    
                    {% if document.is_expired %}
                      <span class="status-badge">
                        <span class="badge rounded-pill bg-danger">Expired</span>
                      </span>
                    {% elif document.expiry_date|timeuntil:today <= '30 days' %}
                      <span class="status-badge">
                        <span class="badge rounded-pill bg-warning">Expiring Soon</span>
                      </span>
                    {% else %}
                      <span class="status-badge">
                        <span class="badge rounded-pill bg-success">Valid</span>
                      </span>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="alert alert-info">
              No documents found for this vehicle.
            </div>
          {% endif %}
        </div>
        
        <!-- Maintenance Tab -->
        <div class="tab-pane fade" id="maintenance" role="tabpanel" aria-labelledby="maintenance-tab">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0">Maintenance Records</h5>
            {% if request.user.user_type != 'driver' %}
              <a href="{% url 'maintenance_create' %}?vehicle={{ vehicle.id }}" class="btn btn-sm btn-primary">
                <i class="fas fa-plus me-1"></i> Add Maintenance
              </a>
            {% endif %}
          </div>
          
          {% if maintenance_records %}
            <div class="row">
              {% for record in maintenance_records %}
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="card maintenance-card h-100">
                    <div class="card-body p-3">
                      <h6 class="card-title">{{ record.maintenance_type.name }}</h6>
                      <p class="card-text small mb-2">
                        Reported: {{ record.date_reported|date:"M d, Y" }}<br>
                        Odometer: {{ record.odometer_reading }} km<br>
                        {% if record.provider %}
                          Provider: {{ record.provider.name }}<br>
                        {% endif %}
                        {% if record.cost %}
                          Cost: ${{ record.cost }}<br>
                        {% endif %}
                      </p>
                      <div class="mt-2">
                        <a href="{% url 'maintenance_detail' record.id %}" class="btn btn-sm btn-primary">
                          <i class="fas fa-info-circle"></i> Details
                        </a>
                      </div>
                    </div>
                    
                    <span class="status-badge">
                      <span class="badge rounded-pill bg-{{ record.status|status_color }}">
                        {{ record.get_status_display }}
                      </span>
                    </span>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="alert alert-info">
              No maintenance records found for this vehicle.
            </div>
          {% endif %}
        </div>
        
        <!-- Fuel/Charging Tab -->
        <div class="tab-pane fade" id="fuel" role="tabpanel" aria-labelledby="fuel-tab">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0">
              {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                <i class="fas fa-bolt"></i> Charging Sessions
              {% else %}
                <i class="fas fa-gas-pump"></i> Fuel Transactions
              {% endif %}
            </h5>
            <a href="{% url 'fuel_transaction_create' %}?vehicle={{ vehicle.id }}" class="btn btn-sm btn-primary">
              <i class="fas fa-plus me-1"></i> 
              {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                Add Charging Session
              {% else %}
                Add Fuel Transaction
              {% endif %}
            </a>
          </div>
          
          {% if fuel_transactions %}
            <div class="table-responsive">
              <table class="table table-striped table-compact">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Driver</th>
                    {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                      <th>Charging Type</th>
                      <th>Energy (kWh)</th>
                      <th>Cost per kWh</th>
                    {% else %}
                      <th>Fuel Type</th>
                      <th>Quantity (L)</th>
                      <th>Cost per L</th>
                    {% endif %}
                    <th>Total Cost</th>
                    <th>Odometer</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for transaction in fuel_transactions %}
                    <tr>
                      <td>{{ transaction.date|date:"M d, Y" }}</td>
                      <td>{{ transaction.driver.get_full_name }}</td>
                      <td>{{ transaction.fuel_type }}</td>
                      <td>{{ transaction.quantity|floatformat:1 }}</td>
                      <td>${{ transaction.cost_per_liter|floatformat:2 }}</td>
                      <td>${{ transaction.total_cost|floatformat:2 }}</td>
                      <td>{{ transaction.odometer_reading }}</td>
                      <td>
                        <a href="{% url 'fuel_transaction_detail' transaction.id %}" class="btn btn-sm btn-info">
                          <i class="fas fa-info-circle"></i>
                        </a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">
              {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                No charging sessions found for this electric vehicle.
              {% else %}
                No fuel transactions found for this vehicle.
              {% endif %}
            </div>
          {% endif %}
        </div>
        
        <!-- Trips Tab -->
        <div class="tab-pane fade" id="trips" role="tabpanel" aria-labelledby="trips-tab">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0">Trip History</h5>
            {% if request.user.user_type == 'driver' and vehicle.status == 'available' %}
              <a href="{% url 'start_trip' %}?vehicle={{ vehicle.id }}" class="btn btn-sm btn-success">
                <i class="fas fa-play me-1"></i> Start Trip
              </a>
            {% endif %}
          </div>
          
          {% if trips %}
            <div class="table-responsive">
              <table class="table table-striped table-compact">
                <thead>
                  <tr>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Driver</th>
                    <th>Distance</th>
                    <th>Duration</th>
                    {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                      <th>Energy Used</th>
                    {% else %}
                      <th>Fuel Used</th>
                    {% endif %}
                    <th>Purpose</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for trip in trips %}
                    <tr>
                      <td>{{ trip.start_time|date:"M d, Y H:i" }}</td>
                      <td>{{ trip.end_time|date:"M d, Y H:i"|default:"In progress" }}</td>
                      <td>{{ trip.driver.get_full_name }}</td>
                      <td>{{ trip.distance_traveled|default:"In progress" }}</td>
                      <td>
                        {% if trip.duration %}
                          {{ trip.duration|time:"H\h i\m" }}
                        {% else %}
                          In progress
                        {% endif %}
                      </td>
                      <td>
                        {% if 'ELECTRIC' in vehicle.vehicle_type.name.upper or 'EV' in vehicle.vehicle_type.name.upper or 'HYBRID' in vehicle.vehicle_type.name.upper %}
                          {% if trip.energy_consumed %}
                            {{ trip.energy_consumed }} kWh
                          {% else %}
                            N/A
                          {% endif %}
                        {% else %}
                          {% if trip.fuel_consumed %}
                            {{ trip.fuel_consumed }} L
                          {% else %}
                            N/A
                          {% endif %}
                        {% endif %}
                      </td>
                      <td>{{ trip.purpose }}</td>
                      <td>
                        <span class="badge bg-{{ trip.status|status_color }}">
                          {{ trip.get_status_display }}
                        </span>
                      </td>
                      <td>
                        <a href="{% url 'trip_detail' trip.id %}" class="btn btn-sm btn-info">
                          <i class="fas fa-info-circle"></i>
                        </a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">
              No trips found for this vehicle.
            </div>
          {% endif %}
        </div>
        
        <!-- Accidents Tab -->
        <div class="tab-pane fade" id="accidents" role="tabpanel" aria-labelledby="accidents-tab">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0">Accident Records</h5>
            {% if request.user.user_type == 'driver' %}
              <a href="{% url 'accident_create' %}?vehicle={{ vehicle.id }}" class="btn btn-sm btn-danger">
                <i class="fas fa-car-crash me-1"></i> Report Accident
              </a>
            {% endif %}
          </div>
          
          {% if accidents %}
            <div class="row">
              {% for accident in accidents %}
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="card accident-card h-100">
                    <div class="card-body p-3">
                      <h6 class="card-title">Accident on {{ accident.date_time|date:"M d, Y" }}</h6>
                      <p class="card-text small mb-2">
                        Driver: {{ accident.driver.get_full_name }}<br>
                        Location: {{ accident.location }}<br>
                        {% if accident.estimated_cost %}
                          Est. Cost: ${{ accident.estimated_cost|floatformat:2 }}<br>
                        {% endif %}
                        {% if accident.actual_cost %}
                          Actual Cost: ${{ accident.actual_cost|floatformat:2 }}<br>
                        {% endif %}
                      </p>
                      <div class="mt-2">
                        <a href="{% url 'accident_detail' accident.id %}" class="btn btn-sm btn-primary">
                          <i class="fas fa-info-circle"></i> Details
                        </a>
                      </div>
                    </div>
                    
                    <span class="status-badge">
                      <span class="badge rounded-pill bg-{{ accident.status|status_color }}">
                        {{ accident.get_status_display }}
                      </span>
                    </span>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="alert alert-info">
              No accident records found for this vehicle.
            </div>
          {% endif %}
        </div>
        
        <!-- Notes Tab -->
        <div class="tab-pane fade" id="notes" role="tabpanel" aria-labelledby="notes-tab">
          <h5 class="mb-3">Vehicle Notes</h5>
          {% if vehicle.notes %}
            {{ vehicle.notes|linebreaks }}
          {% else %}
            <div class="alert alert-info">
              No notes available for this vehicle.
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}